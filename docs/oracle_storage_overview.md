`docs/oracle_storage_overview.md`

# üõ¢Ô∏è Task 3: Oracle XE Storage ‚Äì Schema & Insert Logic

This document provides full documentation of the relational storage layer for **Task 3 of the B5W2: Customer UX Analytics** challenge. This storage layer enables persistent, normalized storage of cleaned and enriched Google Play Store reviews in an **enterprise-grade Oracle XE database**.

---

## üìê Schema Overview

The database schema is designed to ensure normalization, data integrity, and support for scalable UX enrichment.

### `banks` Table

``` sql
CREATE TABLE banks (
    bank_id INTEGER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    bank_name VARCHAR2(50) UNIQUE NOT NULL
);
```

- Each bank is uniquely stored.

- Insertions ensure no duplicates via bank_name.

### `reviews` Table

```sql
CREATE TABLE reviews (
    review_id VARCHAR2(100) PRIMARY KEY,
    bank_id INTEGER REFERENCES banks(bank_id),
    review_text CLOB,
    rating INTEGER CHECK (rating BETWEEN 1 AND 5),
    review_date DATE,
    source VARCHAR2(50)
);
```

- The `review_id` acts as the unique identifier (from Play Store).

- `bank_id` creates a foreign key link to enforce referential integrity.

- Compatible with `TO_DATE()` inserts and `CLOB` for large review text.

## üîó Insertion Logic  (`oracle_insert.py`)

The insertion process is implemented in `oracle_insert.py`, powered by a class-based approach (`OracleReviewInserter`):

- Handles **foreign key lookup**

- Avoids duplicates

- Catches and **rolls back failed inserts**

- Logs diagnostic messages to aid debugging

Example diagnostic output:

```pgsql
Copy
Edit
‚úÖ Inserted 340 reviews across 3 banks into Oracle XE.
‚ùå Failed to insert review r12345: ORA-00001: unique constraint violated
```

## üîê Secure Connection Setup

- The connector is defined in src/db/oracle_connector.py and follows enterprise credential practices:

```python
import cx_Oracle
import os

connection = cx_Oracle.connect(
    user=os.getenv("ORACLE_USER"),
    password=os.getenv("ORACLE_PASSWORD"),
    dsn=os.getenv("ORACLE_DSN")  # e.g., "localhost/XEPDB1"
)
```

- No hardcoded credentials.

- `.env` or GitHub Actions Secrets compatible.

## üìÅ Input Format

The script expects a cleaned and enriched review file from:

```bash
data/outputs/reviews_with_sentiment_themes.csv
```

Expected columns include:

- `review_id`

- `review` (text)

- `rating`

- `date`

- `bank`

- `source` (e.g. "Google Play")

Each row is parsed, validated, and inserted with diagnostic logging.

## ‚ñ∂Ô∏è How to Run

Once Oracle XE is running locally or in Docker:

```bash
python scripts/oracle_insert.py
```
This:

- Loads the CSV

- Inserts all reviews and banks

- Logs inserted and failed rows

- Can be rerun safely (idempotent logic)

## üß™ Testing & Diagnostics

Validation steps:

1. Confirm insertion:

    ```sql
    SELECT COUNT(*) FROM reviews;
    SELECT DISTINCT bank_name FROM banks;
    ```

2. Check rollback handling:

    - Manually introduce a duplicate `review_id` ‚Üí rerun ‚Üí observe error handling

3. Use `task-3-oracle-storage.ipynb` notebook for:

    - Full schema walk-through

    - Sample inserts

    - Live connection tests

## üì¶ Files Involved

| File                              | Purpose                                     |
|-----------------------------------|---------------------------------------------|
| `scripts/oracle_insert.py`        | Loads data and inserts into Oracle          |
| `src/db/oracle_connector.py`      | Sets up secure Oracle connection            |
| `task-3-oracle-storage.ipynb`     | Visual notebook for testing and walkthrough |
| `docs/oracle_storage_overview.md` | This documentation file                     |